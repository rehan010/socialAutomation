{%extends 'registration/base.html'%}
{%load static%}
{%load humanize%}


{% block content %}
<head>
    <!--    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/css/bootstrap.min.css">-->
</head>
<form method="post" enctype="multipart/form-data">
    {% csrf_token %}
    <style>

    figure {

    text-align: left;
   }
   figcaption {
    font-size: 14px;
    color: gray;
    margin-top: 5px;
    padding-left: 20px;
   }

   .notification.expanded {
        transform: scale(1.1); /* Adjust the scale factor as needed */
    }



    </style>
<!--    <div class="absolute top-0 right-0 mt-10 ml-10 mb-2">-->

<!--          <div class="alert flex items-center bg-blue-500 text-white sm:text-sm text-xs font-bold px-3 py-2 mb-2 message ease-out duration-300 opacity-0.5" role="alert">-->
<!--              <svg class="fill-current w-4 h-4 mr-2" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20">-->
<!--                <path d="M12.432 0c1.34 0 2.01.912 2.01 1.957 0 1.305-1.164 2.512-2.679 2.512-1.269 0-2.009-.75-1.974-1.99C9.789 1.436 10.67 0 12.432 0zM8.309 20c-1.058 0-1.833-.652-1.093-3.524l1.214-5.092c.211-.814.246-1.141 0-1.141-.317 0-1.689.562-2.502 1.117l-.528-.88c2.572-2.186 5.531-3.467 6.801-3.467 1.057 0 1.233 1.273.705 3.23l-1.391 5.352c-.246.945-.141 1.271.106 1.271.317 0 1.357-.392 2.379-1.207l.6.814C12.098 19.02 9.365 20 8.309 20z"/>-->
<!--              </svg>-->
<!--              <p class="hidden notification-text">Instagram dose not support to delete post</p>-->
<!--              <svg class="cross fill-current text-gray-400 text-end m-1 cursor-pointer" xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 18 18">-->
<!--                <path-->
<!--                d="M14.53 4.53l-1.06-1.06L9 7.94 4.53 3.47 3.47 4.53 7.94 9l-4.47 4.47 1.06 1.06L9 10.06l4.47 4.47 1.06-1.06L10.06 9z">-->
<!--                </path>-->
<!--              </svg>-->
<!--          </div>-->
<!--    </div>-->

    <div class="w-1/2 mx-auto bg-white border-0 border-transparent border-solid shadow-soft-xl rounded-2xl bg-clip-border p-8">

        <div class="pl-4">
            <header class="border-b border-grey-400">
                <a href="#"
                   class="block cursor-pointer py-4 flex items-center text-sm outline-none focus:outline-none focus:border-gray-300 transition duration-150 ease-in-out">
                    {% if picture_url %}
                        <img src="{{ picture_url }}" class="h-10 w-10 rounded-full object-cover" />
                    {% else %}
                        <img class="h-10 w-10 rounded-full object-cover" src="{% static 'image/default.png' %}" alt="user"/>
                    {% endif %}
                    <span class="block ml-2 font-bold text-black ">{{ posted_on }}</span>
                    <div class="flex ml-auto relative">
                        <span class="text-xs text-gray-600" >{{ post.created_at }}</span>
                    </div>
                </a>
            </header>
        </div>
        <div>
            <figure>
                <figcaption>{{post.post}}</figcaption>
            </figure>
        </div>
        <br>
        <div class="col-span-2 w-full">
            <div id="carouselExampleIndicators" class="carousel slide " data-interval="false">
                <ol class="carousel-indicators">
                    {% for image in post.images.all %}
                    <li data-target="#carouselExampleIndicators" data-slide-to="{{ forloop.counter0 }}"
                        {% if forloop.first %}class="active" {% endif %}></li>
                    {% endfor %}
                </ol>
                <div class="carousel-inner ">
                    <!-- Loop through the images and create carousel items -->
                    {% for image in post.images.all %}
                    {% if image.is_mp4_file %}
                    <div class="carousel-item {% if forloop.first %}active{% endif %}">
                        <video playsinline="playsinline" width="1400" height="400"
                               muted="muted" loop="loop" class="video h-74" controls>
                            <source src="{{ image.image.url }}" type="video/mp4">
                            Your browser does not support the video tag.
                        </video>
                    </div>
                    {% else %}
                    <div class="carousel-item {% if forloop.first %}active{% endif %}">
                        <img src="{{ image.image.url }}" class="image h-74 w-100" alt="Image">
                    </div>
                    {% endif %}
                    {% endfor %}
                </div>
                <a class="carousel-control-prev" href="#carouselExampleIndicators" role="button"
                   data-slide="prev">
                    <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                    <span class="sr-only">Previous</span>
                </a>
                <a class="carousel-control-next" href="#carouselExampleIndicators" role="button"
                   data-slide="next">
                    <span class="carousel-control-next-icon" aria-hidden="true"></span>
                    <span class="sr-only">Next</span>
                </a>
            </div>
        </div>
        <input type="hidden" value="{{page_id}}" id="page_id">
        <input type="hidden" value="{{post_id}}" id="post_id">
        <br>
        <!-- Likes and Comment Count -->
        <div class="flex justify-between items-center text-gray-600 mb-2">
            <div class="flex items-center">
                <input type="hidden" id="post" value="{{post_id}}">
                <input type="hidden" id="page" value="{{page_id}}">

                {% if user_role == 'MEMBER' and permission == 'WRITE' %}
                {% if is_liked %}
                <button onclick="deleteLike('',event)" type="button" class="like-button relative focus:outline-red">
                    <svg class="fill-heart text-gray-700 inline-block h-5 w-5 heart" xmlns="http://www.w3.org/2000/svg"
                         fill="red" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                              d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z"/>
                    </svg>
                </button>
                {% else %}
                <button onclick="postLike('',event)" type="button" class="like-button relative focus:outline-red">
                    <svg class="fill-heart text-gray-700 inline-block h-5 w-5 heart" xmlns="http://www.w3.org/2000/svg"
                         fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                              d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z"/>
                    </svg>
                </button>
                {% endif %}
                {% elif post.user == request.user %}
                {% if is_liked %}
                <button onclick="deleteLike('',event)" type="button" class="like-button relative focus:outline-red">
                    <svg class="fill-heart text-gray-700 inline-block h-5 w-5 heart" xmlns="http://www.w3.org/2000/svg"
                         fill="red" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                              d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z"/>
                    </svg>
                </button>
                {% else %}
                <button onclick="postLike('',event)" type="button" class="like-button relative focus:outline-red">
                    <svg class="fill-heart text-gray-700 inline-block h-5 w-5 heart" xmlns="http://www.w3.org/2000/svg"
                         fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                              d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z"/>
                    </svg>
                </button>
                {% endif %}
                {% else %}
                <svg class="fill-heart text-gray-700 inline-block h-5 w-5 heart"
                     xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"
                     stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                          d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z"/>
                </svg>
                {% endif %}
                <span id="likes-count" class="text-gray-600 text-sm font-bold ml-1"> {{ no_likes }} Likes</span>
            </div>
            <div class="flex items-center">
                        <span class="mr-3 inline-flex items-center cursor-pointer">
                            <svg class="text-gray-700 inline-block h-5 w-5" xmlns="http://www.w3.org/2000/svg"
                                 fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                      d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"/>
                            </svg>
                        </span>

                {% if post.comment_check %}
                <span class="text-gray-600 text-sm font-bold">{{ no_comments }} Comments</span>
                {% if provider_name != "instagram" %}
                    {% if user_role == 'MEMBER' and permission == 'WRITE' or post.user == request.user %}
                        <div class="mx-4 relative cursor-pointer">
                            <i class="fas fa-ellipsis-h delete-dropdownButton"></i>
                            <ul class="absolute text-sm before:font-awesome before:leading-default before:duration-350 before:ease-soft lg:shadow-soft-3xl duration-250 min-w-44 before:sm:right-7.5 before:text-5.5  origin-top list-none absolute right-0 top-0 z-50 origin-top list-none rounded-lg border-0 border-solid border-transparent bg-white bg-clip-padding py-2 text-left text-slate-500 transition-all before:absolute before:right-0 before:left-auto before:top-0 before:z-50 before:inline-block before:font-normal before:text-white before:antialiased before:transition-all before:content-['\f0d8'] sm:-mr-6 lg:absolute lg:right-3 lg:left-auto lg:mt-2 lg:block lg:cursor-pointer before:-top-5 transform-dropdown-show delete-dropdown" style="display:none;">
                                <li class="relative hover:bg-gray-100 rounded-lg duration-300 lg:transition-colors">
                                    <a onclick="delete_post_comments(this)" data-comment-urn="{{ comment.comment_urn }}" data-actor="{{ comment.actor }}" data-comment-id="{{ comment.comment_id }}" class="ease-soft py-1.2 clear-both block w-full whitespace-nowrap rounded-lg bg-transparent px-4 duration-300 hover:text-slate-700 lg:transition-colors hover:no-underline" >
                                        <i class="fa-solid fa-trash mx-2"></i> Delete Post
                                    </a>

                                </li>
                            </ul>
                        </div>
                    {% endif %}
                {% endif %}

                {% else %}
                <span class="text-gray-600 text-sm font-bold">0</span>
                {% endif %}
            </div>
        </div>
        <br>
        {% if user_role == 'MEMBER' and permission == 'WRITE' %}
        <!-- New Comment Card -->
        <div class="w-full border rounded-lg p-3 mb-4">
            <textarea class="w-full border rounded-lg bg-gray-100 p-2" name="comment"
                      placeholder="Write a comment..."></textarea>
            <!--                    {% if provider_name == 'facebook' %}-->
            <!--                        <div>-->
            <!--                            <label for="file-upload" class="file-upload-label">-->
            <!--                                <i class="fa-solid fa-paperclip"></i>-->
            <!--                            </label>-->
            <!--                            <input type="file" name="comment_media" id="file-upload" class="file-upload hidden">-->
            <!--                        </div>-->
            <!--                    {% endif %}-->
            <button class="mt-2 px-4 py-2 text-xs text-white ease-soft-in shadow-soft-md bg-150 bg-gradient-to-tl from-gray-900 to-slate-800 hover:shadow-soft-xs active:opacity-85 hover:scale-102 tracking-tight-soft bg-x-25 no-underline hover:no-underline rounded mr-2">
                Post Comment
            </button>
        </div>
        {% elif post.user == request.user %}
        <div class="w-full border rounded-lg p-3 mb-4">
            <textarea class="w-full border rounded-lg bg-gray-100 p-2" name="comment"
                      placeholder="Write a comment..."></textarea>
            <!--                    {% if provider_name == 'facebook' %}-->
            <!--                        <div>-->
            <!--                            <label for="file-upload" class="file-upload-label">-->
            <!--                                <i class="fa-solid fa-paperclip"></i>-->
            <!--                            </label>-->
            <!--                            <input type="file" name="comment_media" id="file-upload" class="file-upload hidden">-->
            <!--                        </div>-->
            <!--                    {% endif %}-->

            <button class="mt-2 px-4 py-2 text-xs text-white ease-soft-in shadow-soft-md bg-150 bg-gradient-to-tl from-gray-900 to-slate-800 hover:shadow-soft-xs active:opacity-85 hover:scale-102 tracking-tight-soft bg-x-25 no-underline hover:no-underline rounded mr-2">
                Post Comment
            </button>
        </div>
        {% endif %}
        {% if post.comment_check %}
        {% for comment in data %}
        <input type="hidden" name="comment_urn" value="{{ comment.comment_urn }}">
        <input type="hidden" name="user_id" value="{{comment.user_id}}">
        <div class="w-full  rounded-lg p-3">
            <div class="flex items-start bg-gray-50 space-x-4">
                {% if comment.profile_image %}
                <img class="h-10 w-10 rounded-full object-cover" src="{{ comment.profile_image }}"
                     alt="{{ comment.name }}"/>
                {% else %}
                <img class="h-10 w-10 rounded-full object-cover" src="{% static 'image/default.png' %}"
                     alt="{{ comment.name }}"/>
                {% endif %}
                <!-- Comment Card -->
                <div class="w-full border rounded-lg p-3">
                    <!-- Comment content -->
                    <p class="font-bold">{{ comment.name }}:</p>
                    <p class="text-gray-700">{{ comment.text }}</p>
                    {% if user_role == 'MEMBER' and permission == 'WRITE' %}
                    <div class="w-full flex justify-end">
                        {% if comment.liked %}
                        <button onclick="deleteLike('{{ comment.comment_urn }}',event)" type="button"
                                class="like-button relative focus:outline-red">
                            <svg class="fill-heart text-gray-700 inline-block h-5 w-5 heart"
                                 xmlns="http://www.w3.org/2000/svg"
                                 fill="red" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                      d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z"/>
                            </svg>
                        </button>
                        {% else %}
                        <button onclick="postLike('{{ comment.comment_urn }}',event)" type="button"
                                class="like-button relative focus:outline-red">
                            <svg class="fill-heart text-gray-700 inline-block h-5 w-5 heart"
                                 xmlns="http://www.w3.org/2000/svg"
                                 fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                      d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z"/>
                            </svg>
                        </button>
                        {% endif %}
                        <div class="mx-4 relative cursor-pointer">
                            <i class="fas fa-ellipsis-h delete-dropdownButton"></i>
                            <ul class="absolute text-sm before:font-awesome before:leading-default before:duration-350 before:ease-soft lg:shadow-soft-3xl duration-250 min-w-44 before:sm:right-7.5 before:text-5.5  origin-top list-none absolute right-0 top-0 z-50 origin-top list-none rounded-lg border-0 border-solid border-transparent bg-white bg-clip-padding py-2 text-left text-slate-500 transition-all before:absolute before:right-0 before:left-auto before:top-0 before:z-50 before:inline-block before:font-normal before:text-white before:antialiased before:transition-all before:content-['\f0d8'] sm:-mr-6 lg:absolute lg:right-3 lg:left-auto lg:mt-2 lg:block lg:cursor-pointer before:-top-5 transform-dropdown-show delete-dropdown" style="display:none;">
                                <li class="relative hover:bg-gray-100 rounded-lg duration-300 lg:transition-colors">
                                    <a onclick="delete_post_comments(this)" data-comment-urn="{{ comment.comment_urn }}" data-actor="{{ comment.actor }}" data-comment-id="{{ comment.comment_id }}" class="ease-soft py-1.2 clear-both block w-full whitespace-nowrap rounded-lg bg-transparent px-4 duration-300 hover:text-slate-700 lg:transition-colors hover:no-underline" >
                                        <i class="fa-solid fa-trash mx-2"></i> Delete Comment
                                    </a>

                                </li>

                            </ul>
                        </div>
                    </div>
                    {% elif post.user == request.user %}
                    <div class="w-full flex justify-end">
                        {% if comment.liked %}
                        <button onclick="deleteLike('{{ comment.comment_urn }}',event)" type="button"
                                class="like-button relative focus:outline-red">
                            <svg class="fill-heart text-gray-700 inline-block h-5 w-5 heart"
                                 xmlns="http://www.w3.org/2000/svg"
                                 fill="red" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                      d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z"/>
                            </svg>
                        </button>
                        {% else %}
                        <button onclick="postLike('{{ comment.comment_urn }}',event)" type="button"
                                class="like-button relative focus:outline-red">
                            <svg class="fill-heart text-gray-700 inline-block h-5 w-5 heart"
                                 xmlns="http://www.w3.org/2000/svg"
                                 fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                      d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z"/>
                            </svg>
                        </button>
                        {% endif %}
                        <div class="mx-4 relative cursor-pointer">
                            <i class="fas fa-ellipsis-h delete-dropdownButton"></i>
                            <ul class="absolute text-sm before:font-awesome before:leading-default before:duration-350 before:ease-soft lg:shadow-soft-3xl duration-250 min-w-44 before:sm:right-7.5 before:text-5.5  origin-top list-none absolute right-0 top-0 z-50 origin-top list-none rounded-lg border-0 border-solid border-transparent bg-white bg-clip-padding py-2 text-left text-slate-500 transition-all before:absolute before:right-0 before:left-auto before:top-0 before:z-50 before:inline-block before:font-normal before:text-white before:antialiased before:transition-all before:content-['\f0d8'] sm:-mr-6 lg:absolute lg:right-3 lg:left-auto lg:mt-2 lg:block lg:cursor-pointer before:-top-5 transform-dropdown-show delete-dropdown" style="display:none;">
                                <li class="relative hover:bg-gray-100 rounded-lg duration-300 lg:transition-colors">
                                    <a onclick="delete_post_comments(this)" data-comment-urn="{{ comment.comment_urn }}" data-actor="{{ comment.actor }}" data-comment-id="{{ comment.comment_id }}" class="ease-soft py-1.2 clear-both block w-full whitespace-nowrap rounded-lg bg-transparent px-4 duration-300 hover:text-slate-700 lg:transition-colors hover:no-underline" >
                                        <i class="fa-solid fa-trash mx-2"></i> Delete Comment
                                    </a>

                                </li>

                            </ul>
                        </div>
                    </div>
                    {% endif %}
                    <div class="mt-4 space-y-4">
                        {% if comment.replies|length > 0%}
                        {% for reply in comment.replies %}
                        {% if reply %}
                            <div class="flex items-start space-x-4 bg-gray-100">
                                {% if reply.profile_image %}
                                <img class="h-10 w-10 rounded-full object-cover" src="{{ reply.profile_image }}" alt=""/>
                                {% else %}
                                <img class="h-10 w-10 rounded-full object-cover" src="{% static 'image/default.png' %}"
                                     alt="{{ comment.name }}"/>
                                {% endif %}
                                {% if reply.text %}
                                <div class="flex-1 rounded-lg p-3">
                                    <!-- Reply content -->
                                    <p class="font-bold">{{ reply.name }}:</p>
                                    <p class="text-gray-700">{{ reply.text }}</p>
                                    {% if user_role == 'MEMBER' and permission == 'WRITE' %}
                                    <div class="w-full flex justify-end">
                                        {% if reply.liked %}
                                        <button onclick="deleteLike('{{ reply.comment_urn }}',event)" type="button"
                                                class="like-button relative focus:outline-red">
                                            <svg class="fill-heart text-gray-700 inline-block h-5 w-5 heart"
                                                 xmlns="http://www.w3.org/2000/svg"
                                                 fill="red" viewBox="0 0 24 24" stroke="currentColor">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                                      d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z"/>
                                            </svg>
                                        </button>
                                        {% else %}
                                        <button onclick="postLike('{{ reply.comment_urn }}',event)" type="button"
                                                class="like-button relative focus:outline-red">
                                            <svg class="fill-heart text-gray-700 inline-block h-5 w-5 heart"
                                                 xmlns="http://www.w3.org/2000/svg"
                                                 fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                                      d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z"/>
                                            </svg>
                                        </button>
                                        {% endif %}
                                        <div class="mx-4 relative cursor-pointer">
                                            <i class="fas fa-ellipsis-h delete-dropdownButton"></i>
                                            <ul class="absolute text-sm before:font-awesome before:leading-default before:duration-350 before:ease-soft lg:shadow-soft-3xl duration-250 min-w-44 before:sm:right-7.5 before:text-5.5  origin-top list-none absolute right-0 top-0 z-50 origin-top list-none rounded-lg border-0 border-solid border-transparent bg-white bg-clip-padding py-2 text-left text-slate-500 transition-all before:absolute before:right-0 before:left-auto before:top-0 before:z-50 before:inline-block before:font-normal before:text-white before:antialiased before:transition-all before:content-['\f0d8'] sm:-mr-6 lg:absolute lg:right-3 lg:left-auto lg:mt-2 lg:block lg:cursor-pointer before:-top-5 transform-dropdown-show delete-dropdown" style="display:none;">
                                                <li class="relative hover:bg-gray-100 rounded-lg duration-300 lg:transition-colors">
                                                    <a onclick="delete_post_comments(this)" data-comment-urn="{{ reply.comment_urn }}" data-actor="{{ reply.actor }}" data-comment-id="{{ reply.comment_id }}" class="ease-soft py-1.2 clear-both block w-full whitespace-nowrap rounded-lg bg-transparent px-4 duration-300 hover:text-slate-700 lg:transition-colors hover:no-underline" >
                                                        <i class="fa-solid fa-trash mx-2"></i> Delete Reply
                                                    </a>

                                                </li>

                                            </ul>
                                        </div>
                                    </div>
                                    {% elif post.user == request.user %}
                                    <div class="w-full flex justify-end">
                                        {% if reply.liked %}
                                        <button onclick="deleteLike('{{ reply.comment_urn }}',event)" type="button"
                                                class="like-button relative focus:outline-red">
                                            <svg class="fill-heart text-gray-700 inline-block h-5 w-5 heart"
                                                 xmlns="http://www.w3.org/2000/svg"
                                                 fill="red" viewBox="0 0 24 24" stroke="currentColor">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                                      d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z"/>
                                            </svg>
                                        </button>
                                        {% else %}
                                        <button onclick="postLike('{{ reply.comment_urn }}',event)" type="button"
                                                class="like-button relative focus:outline-red">
                                            <svg class="fill-heart text-gray-700 inline-block h-5 w-5 heart"
                                                 xmlns="http://www.w3.org/2000/svg"
                                                 fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                                      d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z"/>
                                            </svg>
                                        </button>
                                        {% endif %}
                                        <div class="mx-4 relative cursor-pointer">
                                            <i class="fas fa-ellipsis-h delete-dropdownButton"></i>
                                            <ul class="absolute text-sm before:font-awesome before:leading-default before:duration-350 before:ease-soft lg:shadow-soft-3xl duration-250 min-w-44 before:sm:right-7.5 before:text-5.5  origin-top list-none absolute right-0 top-0 z-50 origin-top list-none rounded-lg border-0 border-solid border-transparent bg-white bg-clip-padding py-2 text-left text-slate-500 transition-all before:absolute before:right-0 before:left-auto before:top-0 before:z-50 before:inline-block before:font-normal before:text-white before:antialiased before:transition-all before:content-['\f0d8'] sm:-mr-6 lg:absolute lg:right-3 lg:left-auto lg:mt-2 lg:block lg:cursor-pointer before:-top-5 transform-dropdown-show delete-dropdown" style="display:none;">
                                                <li class="relative hover:bg-gray-100 rounded-lg duration-300 lg:transition-colors">
                                                    <a onclick="delete_post_comments(this)" data-comment-urn="{{ reply.comment_urn }}" data-actor="{{ reply.actor }}" data-comment-id="{{ reply.comment_id }}" class="ease-soft py-1.2 clear-both block w-full whitespace-nowrap rounded-lg bg-transparent px-4 duration-300 hover:text-slate-700 lg:transition-colors hover:no-underline" >
                                                        <i class="fa-solid fa-trash mx-2"></i> Delete Reply
                                                    </a>

                                                </li>

                                            </ul>
                                        </div>
                                    </div>
                                    {% endif %}
                                </div>
                                {% endif %}
                            </div>
                        {% endif %}
                        {% endfor %}
                        {% endif %}
                    </div>
                    {% if user_role == 'MEMBER' and permission == 'WRITE' %}
                    <!-- Reply Text Area -->
                    <button class="reply-button">Reply</button>
                    <div class="reply-dialog hidden mt-4 ">
                        <textarea class="reply-textarea w-full border rounded-lg p-2" name="reply" placeholder="Write a reply..."></textarea>
                        <button class="submit-reply px-3 py-1 text-xs text-white ease-soft-in shadow-soft-md bg-150 bg-gradient-to-tl from-gray-900 to-slate-800 hover:shadow-soft-xs active:opacity-85 hover:scale-102 tracking-tight-soft bg-x-25 no-underline hover:no-underline rounded mr-2">
                            Submit Reply
                        </button>
                    </div>

<!--                    <div id="reply_box" class="mt-4 hidden">-->
<!--                        <textarea class="w-full border rounded-lg p-2" name="reply"-->
<!--                                  placeholder="Write a reply..."></textarea>-->
<!--                        &lt;!&ndash;                                        {% if provider_name == 'facebook' %}&ndash;&gt;-->
<!--                        &lt;!&ndash;                                        <div>&ndash;&gt;-->
<!--                        &lt;!&ndash;                                            <label for="file-upload" class="file-upload-label">&ndash;&gt;-->
<!--                        &lt;!&ndash;                                                <i class="fa-solid fa-paperclip"></i>&ndash;&gt;-->
<!--                        &lt;!&ndash;                                            </label>&ndash;&gt;-->
<!--                        &lt;!&ndash;                                            <input type="file" name="reply_media_{{ reply_media_counter |add:'1' }}" id="file-upload-reply" class="file-upload hidden">&ndash;&gt;-->
<!--                        &lt;!&ndash;                                        </div>&ndash;&gt;-->
<!--                        &lt;!&ndash;                                        {% endif %}&ndash;&gt;-->


<!--                        <button class="px-3 py-1 text-xs text-white ease-soft-in shadow-soft-md bg-150 bg-gradient-to-tl from-gray-900 to-slate-800 hover:shadow-soft-xs active:opacity-85 hover:scale-102 tracking-tight-soft bg-x-25 no-underline hover:no-underline rounded mr-2">-->
<!--                            Reply-->
<!--                        </button>-->
<!--                    </div>-->
                    {% elif post.user == request.user %}
                     <button class="reply-button">Reply</button>
                    <div class="reply-dialog hidden mt-4 ">
                        <textarea class="reply-textarea w-full border rounded-lg p-2" name="reply" placeholder="Write a reply..."></textarea>
                        <button class="submit-reply px-3 py-1 text-xs text-white ease-soft-in shadow-soft-md bg-150 bg-gradient-to-tl from-gray-900 to-slate-800 hover:shadow-soft-xs active:opacity-85 hover:scale-102 tracking-tight-soft bg-x-25 no-underline hover:no-underline rounded mr-2">
                            Submit Reply
                        </button>
                    </div>

<!--                    <div class="mt-4 hidden">-->
<!--                        <textarea class="w-full border rounded-lg p-2" name="reply"-->
<!--                                  placeholder="Write a reply..."></textarea>-->
<!--                        &lt;!&ndash;                                        {% if provider_name == 'facebook' %}&ndash;&gt;-->
<!--                        &lt;!&ndash;                                        <div>&ndash;&gt;-->
<!--                        &lt;!&ndash;                                            <label for="file-upload" class="file-upload-label">&ndash;&gt;-->
<!--                        &lt;!&ndash;                                                <i class="fa-solid fa-paperclip"></i>&ndash;&gt;-->
<!--                        &lt;!&ndash;                                            </label>&ndash;&gt;-->
<!--                        &lt;!&ndash;                                            <input type="file" name="reply_media_{{ reply_media_counter |add:'1' }}" id="file-upload-reply" class="file-upload hidden">&ndash;&gt;-->
<!--                        &lt;!&ndash;                                        </div>&ndash;&gt;-->
<!--                        &lt;!&ndash;                                        {% endif %}&ndash;&gt;-->

<!--                        <button class="px-3 py-1 text-xs text-white ease-soft-in shadow-soft-md bg-150 bg-gradient-to-tl from-gray-900 to-slate-800 hover:shadow-soft-xs active:opacity-85 hover:scale-102 tracking-tight-soft bg-x-25 no-underline hover:no-underline rounded mr-2">-->
<!--                            Reply-->
<!--                        </button>-->
<!--                    </div>-->
                    {% endif %}
                </div>
            </div>
        </div>
        <br>
        {% endfor %}

        {% else %}
        <p>Comments are disabled for this post.</p>
        {% endif %}
    </div>
</form>

<script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.5.4/dist/umd/popper.min.js"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/js/bootstrap.min.js"></script>
<script>
    // Manually initialize the carousel
    const myCarousel = new bootstrap.Carousel(document.getElementById('carouselExampleIndicators'), {
        interval: false, // Set to false to disable autoplay
        pause: 'hover',  // Pause on hover (optional, if desired)
    });

    // Play video when the carousel slide is shown
    myCarousel._element.addEventListener('slide.bs.carousel', (event) => {
        const activeSlide = event.relatedTarget;
        const videoElement = activeSlide.querySelector('video');
        if (videoElement) {
            videoElement.play();
        }
    });


    function getCSRFToken() {
        const csrfTokenInput = document.querySelector('input[name=csrfmiddlewaretoken]');
        if (csrfTokenInput) {
            return csrfTokenInput.value;
        } else {
            return null;
        }
    }

    document.addEventListener("DOMContentLoaded", function() {
        const replyButtons = document.querySelectorAll(".reply-button");

        replyButtons.forEach(function(replyButton) {
            replyButton.addEventListener("click", function(event) {
                event.preventDefault();
                const replyDialog = this.nextElementSibling;

                // Hide all other reply dialog boxes
                const allReplyDialogs = document.querySelectorAll(".reply-dialog");
                allReplyDialogs.forEach(function(dialog) {
                    if (dialog !== replyDialog) {
                        dialog.classList.add("hidden");
                        dialog.querySelector("textarea").value = "";
                    }
                });

                // Toggle the visibility of the clicked reply dialog
                replyDialog.classList.toggle("hidden");
            });
        });

        // Add event listeners for reply submission if needed
    });






    const dropdownButtons = document.querySelectorAll(".delete-dropdownButton");

    dropdownButtons.forEach((button) => {

        const dropdown = button.nextElementSibling;


        button.addEventListener('click',function(){
            console.log("Clicked");
            if(dropdown.style.display == "block"){
                dropdown.style.display = "none"
            }
            else{
                dropdown.style.display = "block"
            }



        })


    });

    async function postLike(urn = null,event){
      const page_id = document.getElementById('page_id').value;
      const post_id = document.getElementById('post_id').value;
      const searchParams = new URLSearchParams(window.location.search);
      const provider_name = searchParams.get('page_name');
      const csrfToken = getCSRFToken();
      const parentButton = event.currentTarget;
      let like = parentButton.querySelector("path");

      const json = { 'urn': urn }
      const res = await fetch(
          `/posts/like/${post_id}/${page_id}?page_name=${provider_name}`,{
              method:'Post',
               headers: {
                    'Content-Type': 'application/json',
                    'X-CSRFToken': csrfToken,
                },
               body: JSON.stringify(json)
        });
      const data = await res.json();
      parentButton.onclick = (event) => deleteLike(urn,event);

        like.setAttribute("fill","red");
        if(urn === null || urn === ''){
            const liketextdiv = document.getElementById('likes-count');
            const likeCount = liketextdiv.innerText;
            var likeCountArray = likeCount.split(" ");
            likeCountArray[0] = (parseInt(likeCountArray[0]) + 1).toString();
            var newlikeCount = likeCountArray.join(" ");
            liketextdiv.innerText = newlikeCount;
        }

    }


    async function deleteLike(urn = null,event){
      const page_id = document.getElementById('page_id').value;
      const post_id = document.getElementById('post_id').value;
      const searchParams = new URLSearchParams(window.location.search);
      const provider_name = searchParams.get('page_name');
      const csrfToken = getCSRFToken();
      const parentButton = event.currentTarget;
        let like = parentButton.querySelector("path");
      const json = { 'urn': urn }
      console.log(json);
      const res = await fetch(
          `/posts/like/${post_id}/${page_id}?page_name=${provider_name}`,{
              method:'Delete',
               headers: {
                    'Content-Type': 'application/json',
                    'X-CSRFToken': csrfToken,
                },
               body: JSON.stringify(json)
        });
      const data = await res.json();
        parentButton.onclick = (event) => postLike(urn ,event);
        like.setAttribute("fill","none");

        if(urn === null || urn === ''){
            const liketextdiv = document.getElementById('likes-count');
            const likeCount = liketextdiv.innerText;
            var likeCountArray = likeCount.split(" ");
            likeCountArray[0] = (parseInt(likeCountArray[0]) - 1).toString();
            var newlikeCount = likeCountArray.join(" ");
            liketextdiv.innerText = newlikeCount;
        }


    }


    async function delete_post_comments(button) {
        var urn = button.getAttribute('data-comment-urn');
        var actor = button.getAttribute('data-actor');
        var comment_id = button.getAttribute('data-comment-id');


        const post_id = document.getElementById('post_id').value;
        const page_id = document.getElementById('page_id').value;
        const searchParams = new URLSearchParams(window.location.search);
        const provider_name = searchParams.get('page_name');
        const csrfToken = getCSRFToken();

        const json = { 'urn': urn , 'actor':actor , 'comment_id':comment_id}

        const res = await fetch(
          `/delete-post/${post_id}?page_name=${provider_name}&page_id=${page_id}`,{
              method:'Delete',
               headers: {
                    'Content-Type': 'application/json',
                    'X-CSRFToken': csrfToken,
                },
               body: JSON.stringify(json)
        });
        const data = await res.json();

        if(data['message'] == "success"  ){

            if(data['request'] === 'post'){
                var userId = data['user']
                window.location.href = `/posts/${userId}`
            }else{
                window.location.reload();
            }
         }
        else{
            console.log(data['message'])

        }
    }



</script>
{%endblock%}